import ctypes
import random
import os
import cv2
import time
import datetime
import sys
from PIL import Image
import schedule
# The code
while True:
    print("start")

    Morning_Start = "05:00"
    Morning_End = "08:00"
    #Where the morning files are found - input your full folder directory
    Morning_Pics_File_Dict = r"C:\Users\ADHIT\OneDrive\Cool Proggrammes\WALLPAPER\Sample wallpapers\Morning"
    Aft_Start = "11:30"
    Aft_End = "18:00"
    #Where the afternoon files are found
    Aft_Pics_File_Dict = r"C:\Users\ADHIT\OneDrive\Cool Proggrammes\WALLPAPER\Sample wallpapers\Afternoon"
    Night_Start = "20:00"
    Night_End = "23:59"
    #Time duration for wallpaper switch in mode 2 (in minutes!!!)
    Mode_2_time_delay = 45
    #Where the night files are found
    Night_Pics_File_Dict = r"C:\Users\ADHIT\OneDrive\Cool Proggrammes\WALLPAPER\Sample wallpapers\Night"
    #Where the mode 2 pics are found
    Mode_2_wallpapers = "C:/Users/ADHIT/OneDrive/Cool Proggrammes/WALLPAPER/Sample wallpapers/Test wallpaper"
    #which directory do your seperate folders exsist in - this code needs all seperate folders to exisist in a root directory
    #for the time being at least
    Root_Dict = r"C:\Users\ADHIT\OneDrive\Cool Proggrammes\WALLPAPER\Sample wallpapers"
    Run_Mode_1 = False

    Run_Mode_2 = True

    Checker = False

    now = datetime.datetime.now().strftime("%H:%M")
    raw_morning_pictures = os.listdir(Morning_Pics_File_Dict)  # gets list of files in the morning dir!
    raw_aft_pictures = os.listdir(Aft_Pics_File_Dict)
    raw_night_pictures = os.listdir(Night_Pics_File_Dict)
    raw_test_pictures = os.listdir(Mode_2_wallpapers)
    if Checker == True:
        print("List of morning raw pics")
        print(raw_morning_pictures)

    morning_picture = [] #Creating arrays to store the full location of the pictures
    aft_picture = []
    night_picture = []
    test_picture = []

    for morningpicture in raw_morning_pictures:
        #concatanates the host path and file path
        mpic = os.path.join(Morning_Pics_File_Dict,morningpicture)
        morning_picture.append(mpic) #adds the full file path in the created array

    if Checker == True:
        print("Below is the complete address of the picture and below still is the list of complete addresses in an array")
        print(mpic)
        print(morning_picture)



    for aftpicture in raw_aft_pictures:
         # concatanates the host path and file path
        apic = os.path.join(Aft_Pics_File_Dict,aftpicture)
        aft_picture.append(apic)



    for nightpicture in raw_night_pictures:
        # concatanates the host path and file path
        npic = os.path.join(Night_Pics_File_Dict,nightpicture)
        night_picture.append(npic)



    for picture in raw_test_pictures:
        # concatanates the host path and file path
        pic = os.path.join(Mode_2_wallpapers,picture)
        test_picture.append(pic)



    # creating activate times!

    def createtriggertimes(starttime):

        triggerstart = starttime - datetime.timedelta(minutes=11)
        triggerend = starttime - datetime.timedelta(seconds=1)

        return triggerstart,triggerend





    now = datetime.datetime.now()
    current_time = now.replace(year=1900,month=1,day=1)





    def wallpaperdayswitch(Morning_Start,Aft_Start,Night_Start):

        Morning_Trigger_Start,Morning_Trigger_End = createtriggertimes(Morning_Start)
        Aft_Trigger_Start, Aft_Trigger_End = createtriggertimes(Aft_Start)
        Night_Trigger_Start, Night_Trigger_End = createtriggertimes(Night_Start)


        if now >> Morning_Trigger_Start and now << Morning_Trigger_End:

            m = random.randint(0, len(morning_picture) - 1)

            ctypes.windll.user32.SystemParametersInfoW(20, 0, morning_picture[m], 3)

        if now >> Morning_Start and now << Morning_End:
            pass


        if now >>Aft_Trigger_Start   and now << Aft_Trigger_End:

            a = random.randint(0, len(aft_picture) - 1)

            ctypes.windll.user32.SystemParametersInfoW(20, 0, aft_picture[a], 3)

        if now >> Aft_Start and now << Aft_End:
            pass

        if now >> Night_Trigger_Start and now << Night_Trigger_End:

            n = random.randint(0, len(night_picture) - 1)

            ctypes.windll.user32.SystemParametersInfoW(20, 0, night_picture[n], 3)

        if now >> Night_Start and now << Night_End:

            pass

        else:
            #Not sure where i defined t
            ctypes.windll.user32.SystemParametersInfoW(20, 0, test_picture[t], 3)



    def testwallpaperswitch():

        t = random.randint(0,len(test_picture)-1)
        ctypes.windll.user32.SystemParametersInfoW(20, 0, test_picture[t], 3)



    if Run_Mode_1 == True and Run_Mode_2 == False:
        print("Running mode 1")
        # Get error:Type 'str' doesn't have expected attribute '__sub__' - Not sure why
        wallpaperdayswitch(Morning_Start,Aft_Start,Night_Start)
        print("Func ran, will loop in 599 sec")
        time.sleep(599)

    elif Run_Mode_1 == False and Run_Mode_2 == True:
        print("Running mode 2") # Will be done in the future
        testwallpaperswitch()
        print(f"Func ran will reloop in {Mode_2_time_delay} min")
        time.sleep(Mode_2_time_delay * 60)

    elif Run_Mode_1 == False and Run_Mode_2 == False:
        print("Nothing running")
    elif Run_Mode_1 == True and Run_Mode_2 == True:
        print("Error - both modes are set to true")
    else:
        print("you done goofed up")


    time.sleep(600)





